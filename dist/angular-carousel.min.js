/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.2.4 - 2014-07-25
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["ngTouch"]),angular.module("angular-carousel").directive("rnCarouselAutoSlide",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e=Math.round(1e3*parseFloat(d.rnCarouselAutoSlide)),f=increment=!1,g=c.children().length;b.carouselExposedIndex||(b.carouselExposedIndex=0),stopAutoplay=function(){angular.isDefined(f)&&a.cancel(f),f=void 0},increment=function(){b.carouselExposedIndex=b.carouselExposedIndex<g-1?b.carouselExposedIndex+1:0},restartTimer=function(){stopAutoplay(),f=a(increment,e)},b.$watch("carouselIndex",function(){restartTimer()}),restartTimer(),d.rnCarouselPauseOnHover&&"false"!=d.rnCarouselPauseOnHover&&(c.on("mouseenter",stopAutoplay),c.on("mouseleave",restartTimer)),b.$on("$destroy",function(){stopAutoplay(),c.off("mouseenter",stopAutoplay),c.off("mouseleave",restartTimer)})}}}]),angular.module("angular-carousel").directive("rnCarouselControls",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},link:function(a){a.prev=function(){a.index>0&&a.index--},a.next=function(){a.index<a.items.length-1&&a.index++}},templateUrl:"carousel-controls.html"}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-controls.html",'<div class="rn-carousel-controls">\n  <span class="rn-carousel-control rn-carousel-control-prev" ng-click="prev()" ng-if="index > 0"></span>\n  <span class="rn-carousel-control rn-carousel-control-next" ng-click="next()" ng-if="index < items.length - 1"></span>\n</div>')}]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},templateUrl:"carousel-indicators.html"}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-indicators.html",'<div class="rn-carousel-indicator">\n <span ng-repeat="item in items" ng-click="$parent.index=$index" ng-class="{active: $index==$parent.index}"></span>\n</div>')}]),function(){"use strict";angular.module("angular-carousel").directive("rnCarousel",["$swipe","$window","$document","$parse","$compile","$rootScope",function(a,b,c,d,e,f){var g=0,h=75,i=.05,j=3,k=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame;return{restrict:"A",scope:!0,compile:function(l,m){var s,t,n=l.children()[0].attributes,o=!1,p=!1,r=!1;return l.addClass("rn-carousel-slides"),l.children().addClass("rn-carousel-slide"),["ng-repeat","data-ng-repeat","x-ng-repeat"].every(function(a){var b=n[a];if(angular.isDefined(b)){var c=b.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),d=c[3];if(s=c[1],t=c[2],s)return angular.isDefined(m.rnCarouselBuffered)&&(p=!0,b.value=s+" in "+t+"|carouselSlice:carouselBufferIndex:carouselBufferSize",d&&(b.value+=" track by "+d)),o=!0,!1}return!0}),function(l,m,n){function L(){for(var a=[],b=0;B>b;b++)a[b]=b;l.carouselIndicatorArray=a}function M(a){var b=F.children();return u=0===b.length?F[0].getBoundingClientRect().height:b[a].getBoundingClientRect().height}function N(a){G.css("height","100%");var b=M(a);b&&G.css("height",b+"px")}function O(){var a=F.children();return s=0===a.length?F[0].getBoundingClientRect().width:a[0].getBoundingClientRect().width}function P(){G.css("width","100%");var a=O();a&&G.css("width",a+"px")}function Q(a){N(l.carouselIndex),isNaN(a)&&(a=l.carouselIndex*s),z=a;var b=-Math.round(z);b+=l.carouselBufferIndex*s,F[0].style[v]=ab?"translate3d("+b+"px, 0, 0)":"translate("+b+"px, 0)"}function R(){var a,b;y&&(a=Date.now()-E,b=y*Math.exp(-a/h),b>j||-j>b?(Q(A-b),k(R)):U(A/s))}function S(a){return a>=B?B:0>=a?0:a}function T(){var a=0,b=(l.carouselBufferSize-1)/2;p&&(a=l.carouselIndex<=b?0:B<l.carouselBufferSize?0:l.carouselIndex>B-l.carouselBufferSize?B-l.carouselBufferSize:l.carouselIndex-b),l.carouselBufferIndex=a}function U(a,b){return isNaN(a)&&(a=l.carouselIndex),b?(z=a*s,$(null,null,!0),void 0):(l.carouselIndex=S(a),T(),"$apply"!==f.$$phase&&"$digest"!==f.$$phase&&(r?l.$apply():l.$digest()),Q(),void 0)}function V(){return i*s}function W(a){C=!0,$({x:a.clientX,y:a.clientY},a)}function X(a){var b=a;return 0===l.carouselIndex?b=Math.max(-V(),b):l.carouselIndex===B-1&&(b=Math.min((B-1)*s+V(),b)),b}function Y(a){return c.bind("mouseup",W),w=!0,x=a.x,y=0,E=Date.now(),!1}function Z(a){var c,d;return w&&(c=a.x,d=x-c,(d>2||-2>d)&&(C=!0,x=c,k(function(){Q(X(z+d))}))),!1}function $(a,b,d){if(!b||C){c.unbind("mouseup",W),w=!1,C=!1,A=z;var e=V(),f=l.carouselIndex*s,g=f-A,h=-Math[g>=0?"ceil":"floor"](g/s),i=Math.abs(g)>e;h+l.carouselIndex>=B&&(h=B-1-l.carouselIndex),h+l.carouselIndex<0&&(h=-l.carouselIndex);var j=i?h:0;return A=(j+l.carouselIndex)*s,y=A-z,E=Date.now(),d&&(y=z-f),k(R),!1}}function _(){var b,a=document.createElement("p"),c={webkitTransform:"-webkit-transform",msTransform:"-ms-transform",transform:"transform"};document.body.insertBefore(a,null);for(var d in c)void 0!==a.style[d]&&(a.style[d]="translate3d(1px,1px,1px)",b=window.getComputedStyle(a).getPropertyValue(c[d]));return document.body.removeChild(a),void 0!==b&&b.length>0&&"none"!==b}function bb(){N(l.carouselIndex),P(),U()}g++;var s,u,v,w,x,y,A,E,z=0,B=0,C=!1,D=!0,F=m.wrap("<div id='carousel-"+g+"' class='rn-carousel-container'></div>"),G=F.parent();if((angular.isDefined(n.rnCarouselIndicator)||angular.isDefined(n.rnCarouselControl))&&(L(),l.$watch("carouselIndex",function(a){l.indicatorIndex=a,l.carouselExposedIndex=a}),l.$watch("indicatorIndex",function(a){U(a,!0)})),angular.isDefined(n.rnCarouselPreventAnimation)&&(D=!1),l.$watch("carouselExposedIndex",function(a){U(a,!0)}),angular.isDefined(n.rnCarouselIndicator)){var H=e("<div id='carousel-"+g+"-indicator' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-indicators class='rn-carousel-indicator'></div>")(l);G.append(H)}if(angular.isDefined(n.rnCarouselControl)){var I=e("<div id='carousel-"+g+"-controls' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-controls class='rn-carousel-controls'></div>")(l);G.append(I)}if(l.carouselBufferIndex=0,l.carouselBufferSize=5,l.carouselIndex=0,n.rnCarouselIndex){var J=function(a){K.assign(l.$parent,a)},K=d(n.rnCarouselIndex);angular.isFunction(K.assign)?(l.$watch("carouselIndex",function(a){J(a)}),l.carouselIndex=K(l),l.$parent.$watch(K,function(a){void 0!==a&&(a>=B?(a=B-1,J(a)):0>a&&(a=0,J(a)),U(a,D))}),r=!0):isNaN(n.rnCarouselIndex)||(l.carouselIndex=parseInt(n.rnCarouselIndex,10))}o?l.$watchCollection(t,function(a){B=0,angular.isArray(a)?B=a.length:angular.isObject(a)&&(B=Object.keys(a).length),L(),s||P(),u||N(l.carouselIndex),U(l.carouselIndex)}):(B=m.children().length,L(),P(),N(l.carouselIndex)),n.$observe("rnCarouselSwipe",function(b){"false"!==b&&"off"!==b?a.bind(F,{start:Y,move:Z,end:$,cancel:function(a){$({},a)}}):F.unbind()}),r||U(l.carouselIndex),v="transform",["webkit","Moz","O","ms"].every(function(a){var b=a+"Transform";return"undefined"!=typeof document.body.style[b]?(v=b,!1):!0});var ab=_(),cb=angular.element(b);cb.bind("orientationchange",bb),cb.bind("resize",bb),l.$on("$destroy",function(){c.unbind("mouseup",W),cb.unbind("orientationchange",bb),cb.unbind("resize",bb)})}}}}])}(),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(a,b,c){return angular.isArray(a)?a.slice(b,b+c):angular.isObject(a)?a:void 0}})}();